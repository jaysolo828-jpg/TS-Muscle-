<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta name="theme-color" content="#0a0a0a"/>
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="T&S Muscle"/>
<title>T&S Muscle</title>
<link rel="apple-touch-icon" href="icon.png"/>
<link rel="icon" type="image/png" href="icon.png"/>
<!-- manifest injected via JS below -->
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@400;600;700&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet"/>
<style>
  :root {
    --red: #CC2027;
    --red-dark: #9e181d;
    --red-glow: rgba(204,32,39,0.35);
    --cream: #F5E6C8;
    --cream-dim: rgba(245,230,200,0.15);
    --black: #0a0a0a;
    --dark: #111111;
    --dark2: #1a1a1a;
    --dark3: #222222;
    --dark4: #2a2a2a;
    --white: #ffffff;
    --gray: #888888;
    --gray-light: #aaaaaa;
    --success: #2ecc71;
    --warning: #f39c12;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    background: var(--black);
    color: var(--white);
    font-family: 'Barlow', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    padding-bottom: 80px;
  }

  /* HEADER */
  .app-header {
    background: var(--dark);
    border-bottom: 2px solid var(--red);
    padding: 14px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  }

  .logo-area {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-icon {
    width: 42px;
    height: 42px;
  }

  .app-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 28px;
    letter-spacing: 2px;
    color: var(--cream);
    line-height: 1;
  }

  .app-title span { color: var(--red); }

  .header-right {
    display: flex;
    gap: 8px;
  }

  .icon-btn {
    background: var(--dark3);
    border: 1px solid var(--dark4);
    color: var(--gray-light);
    width: 38px;
    height: 38px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 18px;
    transition: all 0.2s;
  }
  .icon-btn:hover { border-color: var(--red); color: var(--red); }

  /* BOTTOM NAV */
  .bottom-nav {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--dark);
    border-top: 2px solid var(--dark3);
    display: flex;
    z-index: 100;
    padding-bottom: env(safe-area-inset-bottom);
  }

  .nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px 0 8px;
    cursor: pointer;
    transition: all 0.2s;
    gap: 3px;
    border: none;
    background: none;
    color: var(--gray);
  }

  .nav-item.active { color: var(--red); }
  .nav-item.active .nav-icon { color: var(--red); }

  .nav-icon { font-size: 22px; }
  .nav-label { font-size: 10px; font-family: 'Barlow Condensed', sans-serif; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }

  /* SCREENS */
  .screen { display: none; padding: 16px; }
  .screen.active { display: block; }

  /* CARDS */
  .card {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
  }

  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
  }

  .section-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 22px;
    letter-spacing: 2px;
    color: var(--cream);
    margin-bottom: 14px;
  }

  .section-title span { color: var(--red); }

  /* WORKOUT DAY CARDS */
  .day-card {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 14px;
    margin-bottom: 14px;
    overflow: hidden;
    transition: border-color 0.2s;
  }

  .day-card:hover { border-color: var(--red); }

  .day-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 16px;
    cursor: pointer;
  }

  .day-info { display: flex; align-items: center; gap: 12px; }

  .day-badge {
    background: var(--red);
    color: var(--white);
    font-family: 'Bebas Neue', cursive;
    font-size: 13px;
    letter-spacing: 1px;
    padding: 4px 10px;
    border-radius: 6px;
  }

  .day-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 17px;
    color: var(--cream);
    letter-spacing: 0.5px;
  }

  .day-sub {
    font-size: 12px;
    color: var(--gray);
    margin-top: 1px;
  }

  .start-btn {
    background: var(--red);
    color: var(--white);
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .start-btn:hover { background: var(--red-dark); }

  /* EXERCISE LIST */
  .exercise-list { padding: 0 16px 16px; }

  .exercise-item {
    background: var(--dark3);
    border-radius: 10px;
    padding: 12px 14px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
  }

  .exercise-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 15px;
    color: var(--white);
    flex: 1;
  }

  .exercise-meta {
    font-size: 12px;
    color: var(--gray);
    margin-top: 2px;
  }

  .alt-btn {
    background: none;
    border: 1px solid var(--dark4);
    color: var(--gray);
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 0.5px;
    white-space: nowrap;
    transition: all 0.2s;
  }
  .alt-btn:hover { border-color: var(--cream); color: var(--cream); }

  /* ACTIVE WORKOUT */
  .workout-session {
    display: none;
    position: fixed;
    inset: 0;
    background: var(--black);
    z-index: 200;
    overflow-y: auto;
    padding-bottom: 100px;
  }

  .workout-session.active { display: block; }

  .session-header {
    background: var(--dark);
    border-bottom: 2px solid var(--red);
    padding: 14px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .session-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 22px;
    letter-spacing: 2px;
    color: var(--cream);
  }

  .session-title span { color: var(--red); }

  .close-session {
    background: var(--dark3);
    border: 1px solid var(--dark4);
    color: var(--gray-light);
    padding: 6px 14px;
    border-radius: 8px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    letter-spacing: 0.5px;
  }

  .session-exercise {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 14px;
    margin: 14px 16px 0;
    overflow: hidden;
  }

  .session-exercise.completed { border-color: var(--success); opacity: 0.7; }

  .session-ex-header {
    padding: 14px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--dark3);
  }

  .session-ex-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 17px;
    color: var(--cream);
  }

  .swap-btn {
    background: none;
    border: 1px solid var(--dark4);
    color: var(--gray);
    font-size: 11px;
    padding: 5px 10px;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 0.5px;
    transition: all 0.2s;
  }
  .swap-btn:hover { border-color: var(--cream); color: var(--cream); }

  /* SET ROWS */
  .set-row {
    display: grid;
    grid-template-columns: 30px 1fr 1fr 80px 36px;
    gap: 8px;
    align-items: center;
    padding: 10px 16px;
    border-bottom: 1px solid var(--dark3);
  }

  .set-row:last-of-type { border-bottom: none; }

  .set-num {
    font-family: 'Bebas Neue', cursive;
    font-size: 16px;
    color: var(--red);
    text-align: center;
  }

  .set-input {
    background: var(--dark3);
    border: 1px solid var(--dark4);
    border-radius: 8px;
    color: var(--white);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px;
    font-weight: 600;
    padding: 8px 10px;
    text-align: center;
    width: 100%;
    outline: none;
    transition: border-color 0.2s;
  }
  .set-input:focus { border-color: var(--red); }
  .set-input::placeholder { color: var(--dark4); }

  .rpe-select {
    background: var(--dark3);
    border: 1px solid var(--dark4);
    border-radius: 8px;
    color: var(--white);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 14px;
    font-weight: 600;
    padding: 8px 6px;
    width: 100%;
    outline: none;
    cursor: pointer;
  }

  .set-done-btn {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: 2px solid var(--dark4);
    background: none;
    color: var(--gray);
    font-size: 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .set-done-btn.done { background: var(--success); border-color: var(--success); color: var(--white); }

  .set-labels {
    display: grid;
    grid-template-columns: 30px 1fr 1fr 80px 36px;
    gap: 8px;
    padding: 8px 16px 6px;
    border-bottom: 1px solid var(--dark3);
  }

  .set-label {
    font-size: 10px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--gray);
    text-align: center;
  }

  /* PROGRESS INDICATOR */
  .progress-bar-wrap {
    background: var(--dark3);
    border-radius: 4px;
    height: 4px;
    margin: 0 16px 14px;
    overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%;
    background: var(--red);
    border-radius: 4px;
    transition: width 0.4s ease;
  }

  /* NOTES */
  .notes-area {
    padding: 14px 16px;
    border-top: 1px solid var(--dark3);
  }

  .notes-label {
    font-size: 11px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--gray);
    margin-bottom: 8px;
  }

  .notes-input {
    background: var(--dark3);
    border: 1px solid var(--dark4);
    border-radius: 10px;
    color: var(--white);
    font-family: 'Barlow', sans-serif;
    font-size: 14px;
    padding: 10px 14px;
    width: 100%;
    resize: none;
    outline: none;
    min-height: 70px;
    transition: border-color 0.2s;
  }
  .notes-input:focus { border-color: var(--red); }
  .notes-input::placeholder { color: var(--gray); }

  /* FINISH BUTTON */
  .finish-btn {
    background: var(--red);
    color: var(--white);
    border: none;
    border-radius: 12px;
    padding: 16px;
    font-family: 'Bebas Neue', cursive;
    font-size: 20px;
    letter-spacing: 3px;
    cursor: pointer;
    width: calc(100% - 32px);
    margin: 16px;
    transition: all 0.2s;
    box-shadow: 0 4px 20px var(--red-glow);
  }
  .finish-btn:hover { background: var(--red-dark); }

  /* HISTORY SCREEN */
  .history-item {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 12px;
    padding: 14px 16px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: border-color 0.2s;
  }
  .history-item:hover { border-color: var(--red); }

  .history-date {
    font-size: 11px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--red);
    margin-bottom: 4px;
  }

  .history-day {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 17px;
    color: var(--cream);
  }

  .history-summary {
    font-size: 13px;
    color: var(--gray);
    margin-top: 4px;
  }

  .history-detail {
    display: none;
    margin-top: 12px;
    border-top: 1px solid var(--dark3);
    padding-top: 12px;
  }

  .history-detail.open { display: block; }

  .history-ex {
    margin-bottom: 10px;
  }

  .history-ex-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    color: var(--white);
    margin-bottom: 4px;
  }

  .history-sets {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .history-set-pill {
    background: var(--dark3);
    border-radius: 6px;
    padding: 4px 10px;
    font-size: 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    color: var(--gray-light);
  }

  .history-notes-box {
    background: var(--dark3);
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 13px;
    color: var(--gray-light);
    margin-top: 8px;
    font-style: italic;
  }

  /* PROGRESS SCREEN */
  .exercise-picker {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 10px;
    color: var(--white);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 16px;
    font-weight: 600;
    padding: 12px 14px;
    width: 100%;
    outline: none;
    cursor: pointer;
    margin-bottom: 16px;
  }

  .progress-chart {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 14px;
  }

  .chart-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 15px;
    color: var(--cream);
    margin-bottom: 14px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .chart-area {
    position: relative;
    height: 140px;
    overflow: hidden;
  }

  .chart-svg { width: 100%; height: 100%; }

  .overload-badge {
    background: linear-gradient(135deg, var(--red), var(--red-dark));
    border-radius: 10px;
    padding: 14px 16px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .overload-icon { font-size: 28px; }

  .overload-text { font-family: 'Barlow Condensed', sans-serif; font-size: 15px; line-height: 1.4; }
  .overload-text strong { font-size: 17px; display: block; margin-bottom: 2px; color: var(--cream); }

  /* DELOAD */
  .deload-banner {
    background: linear-gradient(135deg, #1a0a00, #2a1200);
    border: 2px solid var(--warning);
    border-radius: 14px;
    padding: 18px;
    margin-bottom: 16px;
    text-align: center;
  }

  .deload-icon { font-size: 36px; margin-bottom: 8px; }
  .deload-title { font-family: 'Bebas Neue', cursive; font-size: 24px; letter-spacing: 2px; color: var(--warning); margin-bottom: 6px; }
  .deload-text { font-size: 14px; color: var(--gray-light); line-height: 1.5; }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    z-index: 500;
    align-items: flex-end;
    justify-content: center;
  }
  .modal-overlay.open { display: flex; }

  .modal {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 20px 20px 0 0;
    padding: 24px 20px;
    width: 100%;
    max-height: 70vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease;
  }

  @keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
  }

  .modal-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 22px;
    letter-spacing: 2px;
    color: var(--cream);
    margin-bottom: 6px;
  }

  .modal-sub {
    font-size: 13px;
    color: var(--gray);
    margin-bottom: 18px;
  }

  .alt-option {
    background: var(--dark3);
    border: 1px solid var(--dark4);
    border-radius: 12px;
    padding: 14px 16px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .alt-option:hover { border-color: var(--red); }

  .alt-option-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 16px;
    color: var(--white);
    margin-bottom: 4px;
  }

  .alt-option-meta { font-size: 12px; color: var(--gray); }

  .modal-swap-btns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 16px;
  }

  .swap-today-btn {
    background: var(--dark3);
    border: 1px solid var(--dark4);
    color: var(--white);
    padding: 12px;
    border-radius: 10px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .swap-today-btn:hover { border-color: var(--cream); }

  .swap-perm-btn {
    background: var(--red);
    border: none;
    color: var(--white);
    padding: 12px;
    border-radius: 10px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .swap-perm-btn:hover { background: var(--red-dark); }

  .modal-cancel {
    width: 100%;
    background: none;
    border: 1px solid var(--dark4);
    color: var(--gray);
    padding: 12px;
    border-radius: 10px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    margin-top: 10px;
    letter-spacing: 0.5px;
  }

  /* SETTINGS */
  .settings-item {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    transition: border-color 0.2s;
  }
  .settings-item:hover { border-color: var(--red); }

  .settings-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 16px;
    color: var(--cream);
  }

  .settings-sub { font-size: 12px; color: var(--gray); margin-top: 2px; }

  .settings-arrow { color: var(--gray); font-size: 18px; }

  /* WEEK TRACKER */
  .week-tracker {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 14px;
    padding: 16px;
    margin-bottom: 16px;
  }

  .week-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--gray);
    margin-bottom: 12px;
  }

  .week-dots {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .week-dot {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid var(--dark4);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Bebas Neue', cursive;
    font-size: 14px;
    color: var(--gray);
    transition: all 0.2s;
  }

  .week-dot.done { background: var(--red); border-color: var(--red); color: var(--white); }
  .week-dot.deload { background: var(--warning); border-color: var(--warning); color: var(--black); }

  .stat-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 14px;
  }

  .stat-box {
    background: var(--dark2);
    border: 1px solid var(--dark3);
    border-radius: 12px;
    padding: 14px;
    text-align: center;
  }

  .stat-num {
    font-family: 'Bebas Neue', cursive;
    font-size: 32px;
    color: var(--red);
    line-height: 1;
  }

  .stat-label {
    font-size: 11px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--gray);
    margin-top: 4px;
  }

  /* TOAST */
  .toast {
    position: fixed;
    bottom: 90px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: var(--dark2);
    border: 1px solid var(--red);
    color: var(--white);
    padding: 10px 20px;
    border-radius: 30px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 14px;
    letter-spacing: 0.5px;
    opacity: 0;
    transition: all 0.3s;
    z-index: 1000;
    white-space: nowrap;
  }
  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

  .empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--gray);
  }
  .empty-state-icon { font-size: 48px; margin-bottom: 12px; }
  .empty-state-text { font-family: 'Barlow Condensed', sans-serif; font-size: 16px; letter-spacing: 0.5px; }

  .pill {
    display: inline-block;
    background: var(--dark3);
    border-radius: 20px;
    padding: 3px 10px;
    font-size: 11px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 0.5px;
    color: var(--gray-light);
  }

  .pill.red { background: var(--red-glow); color: var(--red); }
  .pill.green { background: rgba(46,204,113,0.15); color: var(--success); }

  hr.divider { border: none; border-top: 1px solid var(--dark3); margin: 14px 0; }

  .session-progress-header {
    padding: 12px 16px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--gray);
    margin-bottom: 8px;
  }

</style>
</head>
<body>

<!-- HEADER -->
<header class="app-header">
  <div class="logo-area">
    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8IS0tIEJhY2tncm91bmQgLS0+CiAgPHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSIxMDAiIGZpbGw9IiMwYTBhMGEiLz4KICA8IS0tIFJlZCBhY2NlbnQgYmFyIHRvcCAtLT4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNTEyIiBoZWlnaHQ9IjgiIHJ4PSIwIiBmaWxsPSIjQ0MyMDI3Ii8+CiAgPCEtLSBEdW1iYmVsbCAtLT4KICA8IS0tIExlZnQgY29sbGFyIC0tPgogIDxyZWN0IHg9IjUyIiB5PSIyMTgiIHdpZHRoPSI0OCIgaGVpZ2h0PSI3NiIgcng9IjEwIiBmaWxsPSIjQ0MyMDI3Ii8+CiAgPCEtLSBMZWZ0IHBsYXRlIGlubmVyIC0tPgogIDxyZWN0IHg9Ijk4IiB5PSIyMzIiIHdpZHRoPSIzMCIgaGVpZ2h0PSI0OCIgcng9IjYiIGZpbGw9IiNGNUU2QzgiLz4KICA8IS0tIEJhciAtLT4KICA8cmVjdCB4PSIxMjYiIHk9IjI0OCIgd2lkdGg9IjI2MCIgaGVpZ2h0PSIxNiIgcng9IjgiIGZpbGw9IiNDQzIwMjciLz4KICA8IS0tIFJpZ2h0IHBsYXRlIGlubmVyIC0tPgogIDxyZWN0IHg9IjM4NCIgeT0iMjMyIiB3aWR0aD0iMzAiIGhlaWdodD0iNDgiIHJ4PSI2IiBmaWxsPSIjRjVFNkM4Ii8+CiAgPCEtLSBSaWdodCBjb2xsYXIgLS0+CiAgPHJlY3QgeD0iNDEyIiB5PSIyMTgiIHdpZHRoPSI0OCIgaGVpZ2h0PSI3NiIgcng9IjEwIiBmaWxsPSIjQ0MyMDI3Ii8+CiAgPCEtLSBDZW50ZXIgZ3JpcCBtYXJrcyAtLT4KICA8cmVjdCB4PSIyMjIiIHk9IjI0NCIgd2lkdGg9IjYiIGhlaWdodD0iMjQiIHJ4PSIzIiBmaWxsPSIjMWExYTFhIi8+CiAgPHJlY3QgeD0iMjM4IiB5PSIyNDQiIHdpZHRoPSI2IiBoZWlnaHQ9IjI0IiByeD0iMyIgZmlsbD0iIzFhMWExYSIvPgogIDxyZWN0IHg9IjI1NCIgeT0iMjQ0IiB3aWR0aD0iNiIgaGVpZ2h0PSIyNCIgcng9IjMiIGZpbGw9IiMxYTFhMWEiLz4KICA8cmVjdCB4PSIyNzAiIHk9IjI0NCIgd2lkdGg9IjYiIGhlaWdodD0iMjQiIHJ4PSIzIiBmaWxsPSIjMWExYTFhIi8+CiAgPHJlY3QgeD0iMjg2IiB5PSIyNDQiIHdpZHRoPSI2IiBoZWlnaHQ9IjI0IiByeD0iMyIgZmlsbD0iIzFhMWExYSIvPgogIDwhLS0gVCZTIHRleHQgLS0+CiAgPHRleHQgeD0iMjU2IiB5PSIxOTAiIAogICAgZm9udC1mYW1pbHk9IkFyaWFsIEJsYWNrLCBBcmlhbCwgc2Fucy1zZXJpZiIgCiAgICBmb250LXdlaWdodD0iOTAwIiAKICAgIGZvbnQtc2l6ZT0iMTM2IiAKICAgIGZpbGw9IiNGNUU2QzgiIAogICAgdGV4dC1hbmNob3I9Im1pZGRsZSIKICAgIGxldHRlci1zcGFjaW5nPSItNCI+VCZhbXA7UzwvdGV4dD4KICA8IS0tIE1VU0NMRSB0ZXh0IC0tPgogIDx0ZXh0IHg9IjI1NiIgeT0iNDMwIiAKICAgIGZvbnQtZmFtaWx5PSJBcmlhbCBCbGFjaywgQXJpYWwsIHNhbnMtc2VyaWYiIAogICAgZm9udC13ZWlnaHQ9IjkwMCIgCiAgICBmb250LXNpemU9IjY0IiAKICAgIGZpbGw9IiNDQzIwMjciIAogICAgdGV4dC1hbmNob3I9Im1pZGRsZSIKICAgIGxldHRlci1zcGFjaW5nPSIxMCI+TVVTQ0xFPC90ZXh0PgogIDwhLS0gQm9yZGVyIC0tPgogIDxyZWN0IHg9IjUiIHk9IjUiIHdpZHRoPSI1MDIiIGhlaWdodD0iNTAyIiByeD0iOTciIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0NDMjAyNyIgc3Ryb2tlLXdpZHRoPSI4Ii8+Cjwvc3ZnPg==" class="logo-icon" style="border-radius:8px;" alt="T&S Muscle"/>
    <div>
      <div class="app-title">T<span>&</span>S MUSCLE</div>
    </div>
  </div>
  <div class="header-right">
    <button class="icon-btn" onclick="exportData()" title="Export Data">üì§</button>
  </div>
</header>

<!-- SCREENS -->
<div id="screen-home" class="screen active">
  <div id="deload-banner" style="display:none">
    <div class="deload-banner">
      <div class="deload-icon">‚ö°</div>
      <div class="deload-title">DELOAD WEEK</div>
      <div class="deload-text">You've hit week 7. Drop volume by 40%, same movements, much lighter. Let your joints recover ‚Äî especially your knees.</div>
    </div>
  </div>

  <div class="stat-grid">
    <div class="stat-box">
      <div class="stat-num" id="stat-sessions">0</div>
      <div class="stat-label">Sessions</div>
    </div>
    <div class="stat-box">
      <div class="stat-num" id="stat-week">1</div>
      <div class="stat-label">Current Week</div>
    </div>
  </div>

  <div class="week-tracker">
    <div class="week-label">Program Weeks</div>
    <div class="week-dots" id="week-dots"></div>
  </div>

  <div class="section-title">YOUR <span>PROGRAM</span></div>

  <div id="day-cards"></div>
</div>

<div id="screen-history" class="screen">
  <div class="section-title">WORKOUT <span>HISTORY</span></div>
  <div id="history-list"></div>
</div>

<div id="screen-progress" class="screen">
  <div class="section-title">LIFT <span>PROGRESS</span></div>
  <select class="exercise-picker" id="exercise-picker" onchange="renderProgressChart()"></select>
  <div id="overload-recommendation"></div>
  <div class="progress-chart">
    <div class="chart-title">Max Weight Over Time</div>
    <div class="chart-area"><canvas id="progress-canvas" width="400" height="140"></canvas></div>
  </div>
  <div id="progress-history-table"></div>
</div>

<div id="screen-settings" class="screen">
  <div class="section-title">SETTINGS</div>

  <div class="settings-item" onclick="exportData()">
    <div>
      <div class="settings-label">Export Data</div>
      <div class="settings-sub">Download all workout history as JSON</div>
    </div>
    <div class="settings-arrow">üì§</div>
  </div>

  <div class="settings-item" onclick="importData()">
    <div>
      <div class="settings-label">Import Data</div>
      <div class="settings-sub">Restore from a previous export</div>
    </div>
    <div class="settings-arrow">üì•</div>
  </div>

  <div class="settings-item" onclick="resetWeeks()">
    <div>
      <div class="settings-label">Reset Week Counter</div>
      <div class="settings-sub">Start program from Week 1</div>
    </div>
    <div class="settings-arrow">üîÑ</div>
  </div>

  <div class="settings-item" onclick="restoreDefaults()">
    <div>
      <div class="settings-label">Restore Default Exercises</div>
      <div class="settings-sub">Undo all permanent exercise swaps</div>
    </div>
    <div class="settings-arrow">‚Ü©Ô∏è</div>
  </div>

  <input type="file" id="import-file" accept=".json" style="display:none" onchange="handleImport(event)"/>

  <div style="text-align:center; margin-top:30px; color: var(--gray); font-size:12px; font-family:'Barlow Condensed',sans-serif; letter-spacing:1px;">
    T&S MUSCLE ‚Äî WHERE CULTURE AND PURPOSE COLLIDE
  </div>
</div>

<!-- ACTIVE WORKOUT SESSION -->
<div class="workout-session" id="workout-session">
  <div class="session-header">
    <div>
      <div class="session-title" id="session-title">UPPER <span>A</span></div>
      <div style="font-size:12px; color:var(--gray); font-family:'Barlow Condensed',sans-serif; letter-spacing:0.5px;" id="session-subtitle"></div>
    </div>
    <button class="close-session" onclick="endSession(false)">FINISH</button>
  </div>

  <div class="session-progress-header">
    <span id="session-progress-text">0 / 0 exercises done</span>
    <span id="session-sets-text">0 sets logged</span>
  </div>
  <div class="progress-bar-wrap">
    <div class="progress-bar-fill" id="session-progress-bar" style="width:0%"></div>
  </div>

  <div id="session-exercises"></div>

  <div style="padding:0 16px; margin-top:16px;">
    <div class="notes-label">SESSION NOTES</div>
    <textarea class="notes-input" id="session-notes" placeholder="How did it feel? Any knee issues? PRs?"></textarea>
  </div>

  <button class="finish-btn" onclick="endSession(true)">COMPLETE WORKOUT</button>
</div>

<!-- ALTERNATE EXERCISE MODAL -->
<div class="modal-overlay" id="alt-modal">
  <div class="modal">
    <div class="modal-title">SWAP EXERCISE</div>
    <div class="modal-sub" id="alt-modal-sub">Choose an alternate for this exercise</div>
    <div id="alt-options-list"></div>
    <button class="modal-cancel" onclick="closeAltModal()">CANCEL</button>
  </div>
</div>


<!-- INSTALL BANNER -->
<div id="install-banner" style="display:none; position:fixed; bottom:80px; left:16px; right:16px; z-index:150;">
  <div style="background:linear-gradient(135deg,#CC2027,#9e181d); border-radius:14px; padding:16px 18px; display:flex; align-items:center; justify-content:space-between; box-shadow:0 8px 30px rgba(204,32,39,0.5);">
    <div style="display:flex; align-items:center; gap:12px;">
      <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj4KICA8IS0tIEJhY2tncm91bmQgLS0+CiAgPHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSIxMDAiIGZpbGw9IiMwYTBhMGEiLz4KICA8IS0tIFJlZCBhY2NlbnQgYmFyIHRvcCAtLT4KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNTEyIiBoZWlnaHQ9IjgiIHJ4PSIwIiBmaWxsPSIjQ0MyMDI3Ii8+CiAgPCEtLSBEdW1iYmVsbCAtLT4KICA8IS0tIExlZnQgY29sbGFyIC0tPgogIDxyZWN0IHg9IjUyIiB5PSIyMTgiIHdpZHRoPSI0OCIgaGVpZ2h0PSI3NiIgcng9IjEwIiBmaWxsPSIjQ0MyMDI3Ii8+CiAgPCEtLSBMZWZ0IHBsYXRlIGlubmVyIC0tPgogIDxyZWN0IHg9Ijk4IiB5PSIyMzIiIHdpZHRoPSIzMCIgaGVpZ2h0PSI0OCIgcng9IjYiIGZpbGw9IiNGNUU2QzgiLz4KICA8IS0tIEJhciAtLT4KICA8cmVjdCB4PSIxMjYiIHk9IjI0OCIgd2lkdGg9IjI2MCIgaGVpZ2h0PSIxNiIgcng9IjgiIGZpbGw9IiNDQzIwMjciLz4KICA8IS0tIFJpZ2h0IHBsYXRlIGlubmVyIC0tPgogIDxyZWN0IHg9IjM4NCIgeT0iMjMyIiB3aWR0aD0iMzAiIGhlaWdodD0iNDgiIHJ4PSI2IiBmaWxsPSIjRjVFNkM4Ii8+CiAgPCEtLSBSaWdodCBjb2xsYXIgLS0+CiAgPHJlY3QgeD0iNDEyIiB5PSIyMTgiIHdpZHRoPSI0OCIgaGVpZ2h0PSI3NiIgcng9IjEwIiBmaWxsPSIjQ0MyMDI3Ii8+CiAgPCEtLSBDZW50ZXIgZ3JpcCBtYXJrcyAtLT4KICA8cmVjdCB4PSIyMjIiIHk9IjI0NCIgd2lkdGg9IjYiIGhlaWdodD0iMjQiIHJ4PSIzIiBmaWxsPSIjMWExYTFhIi8+CiAgPHJlY3QgeD0iMjM4IiB5PSIyNDQiIHdpZHRoPSI2IiBoZWlnaHQ9IjI0IiByeD0iMyIgZmlsbD0iIzFhMWExYSIvPgogIDxyZWN0IHg9IjI1NCIgeT0iMjQ0IiB3aWR0aD0iNiIgaGVpZ2h0PSIyNCIgcng9IjMiIGZpbGw9IiMxYTFhMWEiLz4KICA8cmVjdCB4PSIyNzAiIHk9IjI0NCIgd2lkdGg9IjYiIGhlaWdodD0iMjQiIHJ4PSIzIiBmaWxsPSIjMWExYTFhIi8+CiAgPHJlY3QgeD0iMjg2IiB5PSIyNDQiIHdpZHRoPSI2IiBoZWlnaHQ9IjI0IiByeD0iMyIgZmlsbD0iIzFhMWExYSIvPgogIDwhLS0gVCZTIHRleHQgLS0+CiAgPHRleHQgeD0iMjU2IiB5PSIxOTAiIAogICAgZm9udC1mYW1pbHk9IkFyaWFsIEJsYWNrLCBBcmlhbCwgc2Fucy1zZXJpZiIgCiAgICBmb250LXdlaWdodD0iOTAwIiAKICAgIGZvbnQtc2l6ZT0iMTM2IiAKICAgIGZpbGw9IiNGNUU2QzgiIAogICAgdGV4dC1hbmNob3I9Im1pZGRsZSIKICAgIGxldHRlci1zcGFjaW5nPSItNCI+VCZhbXA7UzwvdGV4dD4KICA8IS0tIE1VU0NMRSB0ZXh0IC0tPgogIDx0ZXh0IHg9IjI1NiIgeT0iNDMwIiAKICAgIGZvbnQtZmFtaWx5PSJBcmlhbCBCbGFjaywgQXJpYWwsIHNhbnMtc2VyaWYiIAogICAgZm9udC13ZWlnaHQ9IjkwMCIgCiAgICBmb250LXNpemU9IjY0IiAKICAgIGZpbGw9IiNDQzIwMjciIAogICAgdGV4dC1hbmNob3I9Im1pZGRsZSIKICAgIGxldHRlci1zcGFjaW5nPSIxMCI+TVVTQ0xFPC90ZXh0PgogIDwhLS0gQm9yZGVyIC0tPgogIDxyZWN0IHg9IjUiIHk9IjUiIHdpZHRoPSI1MDIiIGhlaWdodD0iNTAyIiByeD0iOTciIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0NDMjAyNyIgc3Ryb2tlLXdpZHRoPSI4Ii8+Cjwvc3ZnPg==" style="width:44px; height:44px; border-radius:8px;" alt="icon"/>
      <div>
        <div style="font-family:'Bebas Neue',cursive; font-size:18px; letter-spacing:2px; color:#F5E6C8; line-height:1;">INSTALL T&S MUSCLE</div>
        <div style="font-size:11px; color:rgba(255,255,255,0.8); font-family:'Barlow Condensed',sans-serif; margin-top:2px;">Add to your home screen</div>
      </div>
    </div>
    <div style="display:flex; gap:8px; align-items:center;">
      <button onclick="doInstall()" style="background:#F5E6C8; color:#CC2027; border:none; border-radius:10px; padding:10px 18px; font-family:'Bebas Neue',cursive; font-size:17px; letter-spacing:1px; cursor:pointer;">INSTALL</button>
      <button onclick="document.getElementById('install-banner').style.display='none'" style="background:rgba(0,0,0,0.3); border:none; color:white; border-radius:8px; width:32px; height:32px; font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center;">√ó</button>
    </div>
  </div>
</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="nav-item active" onclick="showScreen('home', this)">
    <span class="nav-icon">üè†</span>
    <span class="nav-label">Home</span>
  </button>
  <button class="nav-item" onclick="showScreen('history', this)">
    <span class="nav-icon">üìã</span>
    <span class="nav-label">History</span>
  </button>
  <button class="nav-item" onclick="showScreen('progress', this)">
    <span class="nav-icon">üìà</span>
    <span class="nav-label">Progress</span>
  </button>
  <button class="nav-item" onclick="showScreen('settings', this)">
    <span class="nav-icon">‚öôÔ∏è</span>
    <span class="nav-label">Settings</span>
  </button>
</nav>

<div class="toast" id="toast"></div>

<script>
// ============================================================
// DATA
// ============================================================
const DEFAULT_PROGRAM = [
  {
    id: 'upperA',
    day: 'Monday',
    badge: 'UPPER A',
    name: 'Chest + Triceps + Shoulders',
    exercises: [
      { id: 'bench', name: 'Barbell or DB Bench Press', sets: 4, reps: '8‚Äì10', rest: '2 min',
        alts: [
          { name: 'DB Bench Press', note: 'Allows more natural shoulder path' },
          { name: 'Machine Chest Press', note: 'Good for isolation if shoulder is sensitive' },
          { name: 'Push-Up Weighted', note: 'Bodyweight + plate or vest' }
        ]
      },
      { id: 'incline', name: 'Incline DB Press', sets: 3, reps: '10‚Äì12', rest: '90 sec',
        alts: [
          { name: 'Incline Barbell Press', note: 'More stable, heavier load' },
          { name: 'Incline Machine Press', note: 'No stabilizer requirement' },
          { name: 'Cable Incline Press', note: 'Constant tension throughout' }
        ]
      },
      { id: 'flye', name: 'Cable or Machine Flye', sets: 3, reps: '12‚Äì15', rest: '60 sec',
        alts: [
          { name: 'Pec Deck Flye', note: 'Constant tension, excellent for isolation' },
          { name: 'DB Flye', note: 'Requires careful shoulder position' },
          { name: 'Low Cable Crossover', note: 'Great for upper chest' }
        ]
      },
      { id: 'pushdown', name: 'Tricep Pushdown (Cable)', sets: 3, reps: '12‚Äì15', rest: '60 sec',
        alts: [
          { name: 'Rope Pushdown', note: 'Adds flare at bottom for full contraction' },
          { name: 'Machine Tricep Extension', note: 'If cable is occupied' },
          { name: 'Single Arm Pushdown', note: 'Unilateral, corrects imbalances' }
        ]
      },
      { id: 'overhead-tri', name: 'Overhead Tricep Extension', sets: 3, reps: '10‚Äì12', rest: '60 sec',
        alts: [
          { name: 'Skull Crushers (EZ Bar)', note: 'Heavy tricep long head builder' },
          { name: 'Cable Overhead Extension', note: 'Constant tension version' },
          { name: 'DB Overhead Extension (one arm)', note: 'Unilateral option' }
        ]
      },
      { id: 'lateral', name: 'Lateral Raises (Cable or DB)', sets: 3, reps: '15', rest: '60 sec',
        alts: [
          { name: 'Machine Lateral Raise', note: 'If cable station is busy' },
          { name: 'Cable Lateral Raise', note: 'Constant tension, very effective' },
          { name: 'Leaning DB Lateral Raise', note: 'Better range of motion' }
        ]
      }
    ]
  },
  {
    id: 'lowerA',
    day: 'Tuesday',
    badge: 'LOWER A',
    name: 'Quad / Glute Focus',
    exercises: [
      { id: 'legpress-a', name: 'Leg Press (Mid-foot, moderate stance)', sets: 4, reps: '10‚Äì12', rest: '2 min',
        note: 'Partial ROM ‚Äî stop before knee compression',
        alts: [
          { name: 'Leg Press (Narrow Stance)', note: 'More quad focus' },
          { name: 'Leg Press (Single Leg)', note: 'Unilateral if bilateral bothers knees' }
        ]
      },
      { id: 'rdl', name: 'Romanian Deadlift', sets: 3, reps: '10‚Äì12', rest: '90 sec',
        alts: [
          { name: 'Single Leg RDL', note: 'Unilateral, more glute activation' },
          { name: 'Cable Pull-Through', note: 'Hip hinge, zero knee stress' },
          { name: 'DB Romanian Deadlift', note: 'Same movement, easier to balance' }
        ]
      },
      { id: 'leg-ext-a', name: 'Leg Extension (Machine)', sets: 3, reps: '12‚Äì15', rest: '60 sec',
        alts: [
          { name: 'Single Leg Extension', note: 'Unilateral, address imbalances' }
        ]
      },
      { id: 'ham-curl-a', name: 'Lying or Seated Hamstring Curl', sets: 3, reps: '12‚Äì15', rest: '60 sec',
        alts: [
          { name: 'Seated Hamstring Curl', note: 'Better stretch at top of hamstring' },
          { name: 'Lying Hamstring Curl', note: 'Better contraction at bottom' }
        ]
      },
      { id: 'hip-thrust-a', name: 'Hip Thrust (Barbell or Machine)', sets: 3, reps: '12‚Äì15', rest: '90 sec',
        alts: [
          { name: 'Machine Hip Thrust', note: 'If barbell setup is taken' },
          { name: 'Glute Bridge (Floor)', note: 'Bodyweight or DB on hips' },
          { name: 'Cable Pull-Through', note: 'Hip hinge glute builder' }
        ]
      },
      { id: 'calf-a', name: 'Calf Raise (Machine)', sets: 3, reps: '15‚Äì20', rest: '60 sec',
        alts: [
          { name: 'Leg Press Calf Raise', note: 'Use bottom of leg press' },
          { name: 'Single Leg Calf Raise (Standing)', note: 'Bodyweight on step' }
        ]
      }
    ]
  },
  {
    id: 'upperB',
    day: 'Thursday',
    badge: 'UPPER B',
    name: 'Back + Biceps + Rear Delts',
    exercises: [
      { id: 'chest-row', name: 'Chest Supported Machine Row', sets: 4, reps: '8‚Äì10', rest: '2 min',
        alts: [
          { name: 'Cable Row (Seated)', note: 'Close or wide grip' },
          { name: 'T-Bar Row', note: 'Heavy compound rowing' },
          { name: 'Pendlay Row', note: 'Explosive row from floor' }
        ]
      },
      { id: 'pulldown', name: 'Lat Pulldown', sets: 3, reps: '10‚Äì12', rest: '90 sec',
        alts: [
          { name: 'Wide Grip Pulldown', note: 'More lat width focus' },
          { name: 'Neutral Grip Pulldown', note: 'Easier on shoulder joint' },
          { name: 'Single Arm Pulldown', note: 'Unilateral, great isolation' }
        ]
      },
      { id: 'db-row', name: 'Single Arm DB Row', sets: 3, reps: '10‚Äì12', rest: '90 sec',
        alts: [
          { name: 'Single Arm Cable Row', note: 'Constant tension version' },
          { name: 'Meadows Row', note: 'Landmine variation, great stretch' }
        ]
      },
      { id: 'ez-curl', name: 'Barbell or EZ Bar Curl', sets: 3, reps: '10‚Äì12', rest: '60 sec',
        alts: [
          { name: 'DB Curl', note: 'Allows natural supination' },
          { name: 'Cable Curl', note: 'Constant tension throughout ROM' },
          { name: 'Barbell Curl', note: 'Classic heavy bicep builder' }
        ]
      },
      { id: 'preacher', name: 'Preacher Curl (EZ Bar or DB)', sets: 3, reps: '10‚Äì12', rest: '60 sec',
        alts: [
          { name: 'Machine Preacher Curl', note: 'If preacher bench is taken' },
          { name: 'Concentration Curl', note: 'Peak contraction focus' },
          { name: 'Cable Preacher Curl', note: 'Constant tension version' }
        ]
      },
      { id: 'rear-delt', name: 'Rear Delt Flye ‚Äî use Pec Deck (reverse grip)', sets: 3, reps: '12‚Äì15', rest: '60 sec',
        alts: [
          { name: 'Rear Delt Cable Flye', note: 'Cross cable, arms at 90¬∞' },
          { name: 'Bent Over DB Rear Delt Raise', note: 'Free weight version' },
          { name: 'Machine Rear Delt Flye', note: 'If pec deck is taken' }
        ]
      }
    ]
  },
  {
    id: 'lowerB',
    day: 'Friday',
    badge: 'LOWER B',
    name: 'Quad / Ham Variation',
    exercises: [
      { id: 'legpress-b', name: 'Leg Press (High foot, wide stance)', sets: 4, reps: '10‚Äì12', rest: '2 min',
        note: 'Shifts emphasis to hamstrings and glutes',
        alts: [
          { name: 'Leg Press (Single Leg)', note: 'Unilateral variation' },
          { name: 'Leg Press (Mid-foot)', note: 'Same as Lower A if needed' }
        ]
      },
      { id: 'single-legpress', name: 'Single Leg Press (Unilateral)', sets: 3, reps: '10‚Äì12', rest: '90 sec',
        alts: [
          { name: 'Bilateral Leg Press (narrow)', note: 'If unilateral bothers left knee' }
        ]
      },
      { id: 'leg-ext-b', name: 'Leg Extension (Machine)', sets: 3, reps: '12‚Äì15', rest: '60 sec',
        alts: [
          { name: 'Single Leg Extension', note: 'Unilateral, address imbalances' }
        ]
      },
      { id: 'ham-curl-b', name: 'Nordic Curl or Hamstring Curl', sets: 3, reps: '10‚Äì12', rest: '90 sec',
        alts: [
          { name: 'Seated Hamstring Curl', note: 'Machine variation' },
          { name: 'Lying Hamstring Curl', note: 'Classic machine curl' },
          { name: 'Stability Ball Curl', note: 'If machine is taken' }
        ]
      },
      { id: 'pull-through', name: 'Cable Pull-Through or Hip Thrust', sets: 3, reps: '12‚Äì15', rest: '60 sec',
        alts: [
          { name: 'Hip Thrust (Barbell)', note: 'Heavier load option' },
          { name: 'Glute Bridge', note: 'Bodyweight or DB on hips' },
          { name: 'Kettlebell Swing', note: 'If cable is occupied' }
        ]
      },
      { id: 'calf-b', name: 'Seated Calf Raise', sets: 3, reps: '15‚Äì20', rest: '60 sec',
        alts: [
          { name: 'Standing Calf Raise Machine', note: 'Targets gastrocnemius more' },
          { name: 'Leg Press Calf Raise', note: 'Use bottom of leg press' }
        ]
      }
    ]
  }
];

// ============================================================
// STATE
// ============================================================
let state = {
  program: JSON.parse(JSON.stringify(DEFAULT_PROGRAM)),
  history: [],
  weekCount: 1,
  totalSessions: 0
};

let activeSession = null;
let pendingSwap = null;

function loadState() {
  const saved = localStorage.getItem('ts-muscle-state');
  if (saved) {
    try {
      const parsed = JSON.parse(saved);
      state = { ...state, ...parsed };
      if (!state.program) state.program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));
    } catch(e) {}
  }
}

function saveState() {
  localStorage.setItem('ts-muscle-state', JSON.stringify(state));
}

// ============================================================
// NAVIGATION
// ============================================================
function showScreen(name, el) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('screen-' + name).classList.add('active');
  if (el) el.classList.add('active');

  if (name === 'history') renderHistory();
  if (name === 'progress') renderProgress();
}

// ============================================================
// HOME SCREEN
// ============================================================
function renderHome() {
  document.getElementById('stat-sessions').textContent = state.totalSessions;
  document.getElementById('stat-week').textContent = state.weekCount;

  // Deload banner
  const deloadBanner = document.getElementById('deload-banner');
  deloadBanner.style.display = (state.weekCount === 7) ? 'block' : 'none';

  // Week dots
  const dotsEl = document.getElementById('week-dots');
  dotsEl.innerHTML = '';
  for (let w = 1; w <= 8; w++) {
    const dot = document.createElement('div');
    dot.className = 'week-dot';
    if (w === 7) { dot.classList.add('deload'); dot.textContent = 'D'; }
    else { dot.textContent = w; }
    if (w < state.weekCount) dot.classList.add('done');
    else if (w === state.weekCount && w !== 7) dot.style.borderColor = 'var(--red)';
    dotsEl.appendChild(dot);
  }

  // Day cards
  const container = document.getElementById('day-cards');
  container.innerHTML = '';
  state.program.forEach(day => {
    const card = document.createElement('div');
    card.className = 'day-card';
    card.innerHTML = `
      <div class="day-header" onclick="toggleDayCard('${day.id}')">
        <div class="day-info">
          <div class="day-badge">${day.badge}</div>
          <div>
            <div class="day-name" style="display:flex;align-items:center;gap:6px;">
              ${day.day}
              <span onclick="event.stopPropagation(); openEditDay('${day.id}')" style="font-size:13px;cursor:pointer;color:var(--gray);background:var(--dark3);border-radius:4px;padding:1px 5px;" title="Change day">‚úèÔ∏è</span>
            </div>
            <div class="day-sub">${day.name}</div>
          </div>
        </div>
        <button class="start-btn" onclick="event.stopPropagation(); startSession('${day.id}')">START</button>
      </div>
      <div class="exercise-list" id="exercises-${day.id}" style="display:none">
        ${day.exercises.map(ex => `
          <div class="exercise-item">
            <div>
              <div class="exercise-name">${ex.name}</div>
              <div class="exercise-meta">${ex.sets} sets √ó ${ex.reps}${ex.note ? ' ¬∑ <em>' + ex.note + '</em>' : ''}</div>
            </div>
            ${ex.alts && ex.alts.length ? `<button class="alt-btn" onclick="showAltsPreview('${day.id}','${ex.id}')">ALT</button>` : ''}
          </div>
        `).join('')}
      </div>
    `;
    container.appendChild(card);
  });
}

function toggleDayCard(dayId) {
  const el = document.getElementById('exercises-' + dayId);
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
}

function showAltsPreview(dayId, exId) {
  const day = state.program.find(d => d.id === dayId);
  const ex = day.exercises.find(e => e.id === exId);
  pendingSwap = { dayId, exId, sessionMode: false };
  openAltModal(ex);
}

// ============================================================
// SESSION
// ============================================================
function startSession(dayId) {
  const day = state.program.find(d => d.id === dayId);
  activeSession = {
    dayId,
    dayName: day.badge,
    dayFocus: day.name,
    startTime: Date.now(),
    sets: {},
    notes: '',
    swaps: {}
  };
  day.exercises.forEach(ex => {
    activeSession.sets[ex.id] = Array.from({length: ex.sets}, () => ({ weight: '', reps: '', rpe: '', done: false }));
  });

  renderSession();
  document.getElementById('workout-session').classList.add('active');
}

function renderSession() {
  if (!activeSession) return;
  const day = state.program.find(d => d.id === activeSession.dayId);

  const titleParts = day.badge.split(' ');
  document.getElementById('session-title').innerHTML = titleParts[0] + ' <span>' + titleParts.slice(1).join(' ') + '</span>';
  document.getElementById('session-subtitle').textContent = day.day + ' ¬∑ ' + day.name;

  const container = document.getElementById('session-exercises');
  container.innerHTML = '';

  day.exercises.forEach(ex => {
    const sets = activeSession.sets[ex.id];
    const doneSets = sets.filter(s => s.done).length;
    const isCompleted = doneSets === sets.length;
    const swappedName = activeSession.swaps[ex.id] ? activeSession.swaps[ex.id].name : null;
    const displayName = swappedName || ex.name;

    const exEl = document.createElement('div');
    exEl.className = 'session-exercise' + (isCompleted ? ' completed' : '');
    exEl.id = 'session-ex-' + ex.id;

    let setsHTML = `
      <div class="set-labels">
        <div class="set-label">#</div>
        <div class="set-label">Weight (lbs)</div>
        <div class="set-label">Reps</div>
        <div class="set-label">RPE</div>
        <div class="set-label">‚úì</div>
      </div>
    `;

    sets.forEach((set, si) => {
      // Pre-fill with last session data if available
      const lastData = getLastSetData(ex.id, si);
      const weightPlaceholder = lastData ? lastData.weight : '';
      const repsPlaceholder = lastData ? lastData.reps : '';

      setsHTML += `
        <div class="set-row" id="set-row-${ex.id}-${si}">
          <div class="set-num">${si + 1}</div>
          <input type="number" inputmode="decimal" class="set-input" placeholder="${weightPlaceholder || '0'}"
            value="${set.weight}" onchange="updateSet('${ex.id}',${si},'weight',this.value)"/>
          <input type="number" inputmode="numeric" class="set-input" placeholder="${repsPlaceholder || ex.reps.split('‚Äì')[0]}"
            value="${set.reps}" onchange="updateSet('${ex.id}',${si},'reps',this.value)"/>
          <select class="rpe-select" onchange="updateSet('${ex.id}',${si},'rpe',this.value)">
            <option value="">RPE</option>
            ${[6,6.5,7,7.5,8,8.5,9,9.5,10].map(r => `<option value="${r}" ${set.rpe == r ? 'selected' : ''}>${r}</option>`).join('')}
          </select>
          <button class="set-done-btn ${set.done ? 'done' : ''}" onclick="toggleSetDone('${ex.id}',${si})">‚úì</button>
        </div>
      `;
    });

    exEl.innerHTML = `
      <div class="session-ex-header">
        <div>
          <div class="session-ex-name">${displayName}</div>
          <div style="font-size:12px; color:var(--gray); margin-top:2px; font-family:'Barlow Condensed',sans-serif;">${sets.length} sets √ó ${ex.reps}</div>
        </div>
        ${ex.alts && ex.alts.length ? `<button class="swap-btn" onclick="openSessionSwap('${ex.id}')">SWAP ‚Üî</button>` : ''}
      </div>
      ${setsHTML}
    `;

    container.appendChild(exEl);
  });

  updateSessionProgress();
}

function getLastSetData(exId, setIndex) {
  for (let i = state.history.length - 1; i >= 0; i--) {
    const h = state.history[i];
    if (h.dayId === activeSession.dayId && h.sets && h.sets[exId] && h.sets[exId][setIndex]) {
      return h.sets[exId][setIndex];
    }
  }
  return null;
}

function updateSet(exId, setIndex, field, value) {
  activeSession.sets[exId][setIndex][field] = value;
  updateSessionProgress();
}

function toggleSetDone(exId, setIndex) {
  const set = activeSession.sets[exId][setIndex];
  set.done = !set.done;
  const btn = document.querySelector(`#set-row-${exId}-${setIndex} .set-done-btn`);
  btn.classList.toggle('done', set.done);

  const day = state.program.find(d => d.id === activeSession.dayId);
  const ex = day.exercises.find(e => e.id === exId);
  const sets = activeSession.sets[exId];
  const allDone = sets.every(s => s.done);
  const exEl = document.getElementById('session-ex-' + exId);
  if (exEl) exEl.classList.toggle('completed', allDone);

  updateSessionProgress();
}

function updateSessionProgress() {
  const day = state.program.find(d => d.id === activeSession.dayId);
  let totalSets = 0, doneSets = 0, doneExercises = 0;

  day.exercises.forEach(ex => {
    const sets = activeSession.sets[ex.id];
    totalSets += sets.length;
    const done = sets.filter(s => s.done).length;
    doneSets += done;
    if (done === sets.length) doneExercises++;
  });

  const pct = totalSets > 0 ? (doneSets / totalSets) * 100 : 0;
  document.getElementById('session-progress-bar').style.width = pct + '%';
  document.getElementById('session-progress-text').textContent = `${doneExercises} / ${day.exercises.length} exercises done`;
  document.getElementById('session-sets-text').textContent = `${doneSets} sets logged`;
}

function openSessionSwap(exId) {
  const day = state.program.find(d => d.id === activeSession.dayId);
  const ex = day.exercises.find(e => e.id === exId);
  pendingSwap = { dayId: activeSession.dayId, exId, sessionMode: true };
  openAltModal(ex);
}

function openAltModal(ex) {
  const modal = document.getElementById('alt-modal');
  document.getElementById('alt-modal-sub').textContent = `Alternatives for: ${ex.name}`;
  const list = document.getElementById('alt-options-list');
  list.innerHTML = '';

  if (!ex.alts || ex.alts.length === 0) {
    list.innerHTML = '<div style="color:var(--gray);text-align:center;padding:20px;">No alternatives available</div>';
  } else {
    ex.alts.forEach(alt => {
      const el = document.createElement('div');
      el.className = 'alt-option';
      el.innerHTML = `
        <div class="alt-option-name">${alt.name}</div>
        <div class="alt-option-meta">${alt.note}</div>
        ${pendingSwap.sessionMode ? `
          <div class="modal-swap-btns">
            <button class="swap-today-btn" onclick="doSwap('${alt.name}', false)">JUST TODAY</button>
            <button class="swap-perm-btn" onclick="doSwap('${alt.name}', true)">MAKE PERMANENT</button>
          </div>
        ` : ''}
      `;
      list.appendChild(el);
    });
  }

  modal.classList.add('open');
}

function doSwap(altName, permanent) {
  if (!pendingSwap) return;
  const { dayId, exId } = pendingSwap;

  if (permanent) {
    const day = state.program.find(d => d.id === dayId);
    const ex = day.exercises.find(e => e.id === exId);
    ex.name = altName;
    saveState();
    showToast('Exercise permanently swapped!');
  }

  if (activeSession) {
    activeSession.swaps[exId] = { name: altName };
    renderSession();
    showToast(permanent ? 'Swapped permanently ‚úì' : 'Swapped for today ‚úì');
  }

  closeAltModal();
}

function closeAltModal() {
  document.getElementById('alt-modal').classList.remove('open');
  pendingSwap = null;
}

function endSession(save) {
  if (save && activeSession) {
    activeSession.notes = document.getElementById('session-notes').value;
    activeSession.endTime = Date.now();
    activeSession.date = new Date().toISOString();

    const entry = {
      id: Date.now(),
      dayId: activeSession.dayId,
      dayName: activeSession.dayName,
      dayFocus: activeSession.dayFocus,
      date: activeSession.date,
      sets: activeSession.sets,
      notes: activeSession.notes,
      swaps: activeSession.swaps,
      duration: Math.round((activeSession.endTime - activeSession.startTime) / 60000)
    };

    state.history.push(entry);
    state.totalSessions++;

    // Increment week every 4 sessions
    if (state.totalSessions % 4 === 0) {
      state.weekCount = Math.min(state.weekCount + 1, 8);
      if (state.weekCount > 8) state.weekCount = 1;
    }

    saveState();
    renderHome();
    showToast('Workout saved! üí™');
  }

  document.getElementById('workout-session').classList.remove('active');
  document.getElementById('session-notes').value = '';
  activeSession = null;
}

// ============================================================
// HISTORY
// ============================================================
function renderHistory() {
  const container = document.getElementById('history-list');
  container.innerHTML = '';

  if (state.history.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text">No workouts logged yet. Hit START on any session.</div></div>`;
    return;
  }

  const sorted = [...state.history].reverse();
  sorted.forEach(entry => {
    const date = new Date(entry.date);
    const dateStr = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
    const totalSets = Object.values(entry.sets).reduce((sum, sets) => sum + sets.filter(s => s.done).length, 0);

    const el = document.createElement('div');
    el.className = 'history-item';
    el.innerHTML = `
      <div class="history-date">${dateStr} ¬∑ ${entry.duration || '?'} min</div>
      <div class="history-day">${entry.dayName} ‚Äî ${entry.dayFocus}</div>
      <div class="history-summary">${totalSets} sets completed</div>
      <div class="history-detail" id="detail-${entry.id}">
        ${renderHistoryDetail(entry)}
      </div>
    `;
    el.addEventListener('click', () => {
      const detail = document.getElementById('detail-' + entry.id);
      detail.classList.toggle('open');
    });
    container.appendChild(el);
  });
}

function renderHistoryDetail(entry) {
  const day = state.program.find(d => d.id === entry.dayId);
  if (!day) return '';

  let html = '';
  day.exercises.forEach(ex => {
    const sets = entry.sets[ex.id];
    if (!sets) return;
    const doneSets = sets.filter(s => s.done);
    if (doneSets.length === 0) return;

    const displayName = (entry.swaps && entry.swaps[ex.id]) ? entry.swaps[ex.id].name : ex.name;
    html += `<div class="history-ex">
      <div class="history-ex-name">${displayName}</div>
      <div class="history-sets">
        ${doneSets.map((s, i) => `<div class="history-set-pill">${s.weight ? s.weight + 'lb' : '--'} √ó ${s.reps || '--'}${s.rpe ? ' @ RPE ' + s.rpe : ''}</div>`).join('')}
      </div>
    </div>`;
  });

  if (entry.notes) {
    html += `<div class="history-notes-box">üìù ${entry.notes}</div>`;
  }

  return html;
}

// ============================================================
// PROGRESS
// ============================================================
function renderProgress() {
  const picker = document.getElementById('exercise-picker');
  const allExercises = [];
  DEFAULT_PROGRAM.forEach(day => {
    day.exercises.forEach(ex => {
      allExercises.push({ id: ex.id, name: ex.name, dayId: day.id });
    });
  });

  picker.innerHTML = allExercises.map(ex => `<option value="${ex.id}">${ex.name}</option>`).join('');
  renderProgressChart();
}

function renderProgressChart() {
  const exId = document.getElementById('exercise-picker').value;
  const dataPoints = [];

  state.history.forEach(entry => {
    const sets = entry.sets[exId];
    if (!sets) return;
    const doneSets = sets.filter(s => s.done && s.weight);
    if (doneSets.length === 0) return;
    const maxWeight = Math.max(...doneSets.map(s => parseFloat(s.weight) || 0));
    if (maxWeight > 0) {
      dataPoints.push({ date: new Date(entry.date), weight: maxWeight });
    }
  });

  // Draw chart on canvas
  const canvas = document.getElementById('progress-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = canvas.offsetWidth || 400;
  canvas.height = 140;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (dataPoints.length < 2) {
    ctx.fillStyle = '#888';
    ctx.font = '14px Barlow Condensed, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText(dataPoints.length === 0 ? 'No data yet ‚Äî log some sessions!' : 'Need at least 2 sessions to show trend', canvas.width/2, 70);

    // Show overload recommendation
    document.getElementById('overload-recommendation').innerHTML = '';
    document.getElementById('progress-history-table').innerHTML = '';
    return;
  }

  const weights = dataPoints.map(d => d.weight);
  const minW = Math.min(...weights) * 0.9;
  const maxW = Math.max(...weights) * 1.1;
  const pad = { left: 40, right: 16, top: 16, bottom: 30 };
  const w = canvas.width - pad.left - pad.right;
  const h = canvas.height - pad.top - pad.bottom;

  // Grid lines
  ctx.strokeStyle = '#2a2a2a';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = pad.top + (h / 4) * i;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(pad.left + w, y); ctx.stroke();
    const val = maxW - ((maxW - minW) / 4) * i;
    ctx.fillStyle = '#666';
    ctx.font = '10px Barlow Condensed';
    ctx.textAlign = 'right';
    ctx.fillText(Math.round(val), pad.left - 4, y + 4);
  }

  // Line
  ctx.beginPath();
  ctx.strokeStyle = '#CC2027';
  ctx.lineWidth = 2.5;
  ctx.lineJoin = 'round';
  dataPoints.forEach((pt, i) => {
    const x = pad.left + (i / (dataPoints.length - 1)) * w;
    const y = pad.top + h - ((pt.weight - minW) / (maxW - minW)) * h;
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  });
  ctx.stroke();

  // Area fill
  ctx.beginPath();
  dataPoints.forEach((pt, i) => {
    const x = pad.left + (i / (dataPoints.length - 1)) * w;
    const y = pad.top + h - ((pt.weight - minW) / (maxW - minW)) * h;
    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
  });
  ctx.lineTo(pad.left + w, pad.top + h);
  ctx.lineTo(pad.left, pad.top + h);
  ctx.closePath();
  ctx.fillStyle = 'rgba(204,32,39,0.1)';
  ctx.fill();

  // Dots
  dataPoints.forEach((pt, i) => {
    const x = pad.left + (i / (dataPoints.length - 1)) * w;
    const y = pad.top + h - ((pt.weight - minW) / (maxW - minW)) * h;
    ctx.beginPath();
    ctx.arc(x, y, 4, 0, Math.PI * 2);
    ctx.fillStyle = '#CC2027';
    ctx.fill();
    ctx.beginPath();
    ctx.arc(x, y, 2, 0, Math.PI * 2);
    ctx.fillStyle = '#F5E6C8';
    ctx.fill();
  });

  // Overload recommendation
  const last = dataPoints[dataPoints.length - 1];
  const prev = dataPoints[dataPoints.length - 2];
  let recHTML = '';

  if (last.weight > prev.weight) {
    const nextWeight = last.weight + 5;
    recHTML = `<div class="overload-badge">
      <div class="overload-icon">üî•</div>
      <div class="overload-text">
        <strong>READY TO PROGRESS</strong>
        Try ${nextWeight} lbs next session. You've increased weight ‚Äî keep pushing.
      </div>
    </div>`;
  } else if (last.weight === prev.weight) {
    recHTML = `<div class="overload-badge" style="background:linear-gradient(135deg,#1a1200,#2a2000)">
      <div class="overload-icon">‚ö°</div>
      <div class="overload-text">
        <strong>ADD REPS FIRST</strong>
        Same weight 2+ sessions. Try to hit the top of your rep range before adding weight.
      </div>
    </div>`;
  } else {
    recHTML = `<div class="overload-badge" style="background:linear-gradient(135deg,#001a0a,#002a10)">
      <div class="overload-icon">üõ°Ô∏è</div>
      <div class="overload-text">
        <strong>MAINTAIN & REFOCUS</strong>
        Weight dipped ‚Äî focus on form and hitting your rep targets at this weight first.
      </div>
    </div>`;
  }

  document.getElementById('overload-recommendation').innerHTML = recHTML;

  // Recent history table
  let tableHTML = '<div style="font-family:\'Barlow Condensed\',sans-serif;font-weight:700;font-size:13px;letter-spacing:1px;text-transform:uppercase;color:var(--gray);margin-bottom:8px;">Recent Sessions</div>';
  [...dataPoints].reverse().slice(0, 5).forEach(pt => {
    tableHTML += `<div class="history-item" style="cursor:default;">
      <div class="history-date">${pt.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</div>
      <div class="history-day" style="font-size:20px;">${pt.weight} lbs</div>
    </div>`;
  });
  document.getElementById('progress-history-table').innerHTML = tableHTML;
}

// ============================================================
// EXPORT / IMPORT
// ============================================================
function exportData() {
  const data = JSON.stringify(state, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'ts-muscle-backup-' + new Date().toISOString().slice(0,10) + '.json';
  a.click();
  URL.revokeObjectURL(url);
  showToast('Data exported! ‚úì');
}

function importData() {
  document.getElementById('import-file').click();
}

function handleImport(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (ev) => {
    try {
      const parsed = JSON.parse(ev.target.result);
      state = { ...state, ...parsed };
      saveState();
      renderHome();
      showToast('Data imported successfully! ‚úì');
    } catch(err) {
      showToast('Import failed ‚Äî invalid file');
    }
  };
  reader.readAsText(file);
}

function resetWeeks() {
  if (confirm('Reset week counter to Week 1?')) {
    state.weekCount = 1;
    saveState();
    renderHome();
    showToast('Week counter reset to Week 1');
  }
}

function restoreDefaults() {
  if (confirm('Restore all exercises to their original defaults? This will undo permanent swaps.')) {
    state.program = JSON.parse(JSON.stringify(DEFAULT_PROGRAM));
    saveState();
    renderHome();
    showToast('Default exercises restored ‚úì');
  }
}

// ============================================================
// TOAST
// ============================================================
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2500);
}


// Inline manifest
const manifestData = {
  "name": "T&S Muscle",
  "short_name": "T&S Muscle",
  "description": "T&S Muscle ‚Äî Hypertrophy tracking app.",
  "start_url": ".",
  "display": "standalone",
  "background_color": "#0a0a0a",
  "theme_color": "#CC2027",
  "orientation": "portrait",
  "icons": [
    { "src": "icon.png", "sizes": "192x192", "type": "image/png" },
    { "src": "icon.png", "sizes": "512x512", "type": "image/png" }
  ]
};
const manifestBlob = new Blob([JSON.stringify(manifestData)], {type: 'application/manifest+json'});
const manifestURL = URL.createObjectURL(manifestBlob);
const manifestLink = document.createElement('link');
manifestLink.rel = 'manifest';
manifestLink.href = manifestURL;
document.head.appendChild(manifestLink);

// Inline service worker
if ('serviceWorker' in navigator) {
  const swCode = `
const CACHE_NAME = 'ts-muscle-v1';
self.addEventListener('install', e => { self.skipWaiting(); });
self.addEventListener('activate', e => { self.clients.claim(); });
self.addEventListener('fetch', e => { e.respondWith(fetch(e.request).catch(() => new Response(''))); });
  `;
  const swBlob = new Blob([swCode], {type: 'application/javascript'});
  const swURL = URL.createObjectURL(swBlob);
  navigator.serviceWorker.register(swURL).catch(() => {});
}


// ============================================================
// INIT
// ============================================================
loadState();
renderHome();

// ============================================================
// INSTALL PROMPT
// ============================================================
let deferredPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('install-banner').style.display = 'block';
});

window.addEventListener('appinstalled', () => {
  document.getElementById('install-banner').style.display = 'none';
  deferredPrompt = null;
  showToast('T&S Muscle installed! üí™');
});

function doInstall() {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(choice => {
      if (choice.outcome === 'accepted') {
        showToast('Installing T&S Muscle...');
        document.getElementById('install-btn').style.display = 'none';
      }
      deferredPrompt = null;
      document.getElementById('install-banner').style.display = 'none';
    });
  } else {
    // Show manual install instructions modal
    document.getElementById('install-instructions').style.display = 'flex';
  }
}

// ============================================================
// DAY LABEL EDITING
// ============================================================
let editingDayId = null;
const DAY_OPTIONS = ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday','Any Day'];

function openEditDay(dayId) {
  editingDayId = dayId;
  const grid = document.getElementById('day-options-grid');
  const currentDay = state.program.find(d => d.id === dayId).day;
  grid.innerHTML = DAY_OPTIONS.map(d => `
    <button onclick="selectDayOption('${d}')" style="
      background:${d === currentDay ? 'var(--red)' : 'var(--dark3)'};
      border:1px solid ${d === currentDay ? 'var(--red)' : 'var(--dark4)'};
      color:${d === currentDay ? 'white' : 'var(--gray-light)'};
      border-radius:10px; padding:12px 8px;
      font-family:'Barlow Condensed',sans-serif; font-weight:700;
      font-size:15px; cursor:pointer; letter-spacing:0.5px;
    ">${d}</button>
  `).join('');
  document.getElementById('custom-day-input').value = '';
  document.getElementById('edit-day-modal').classList.add('open');
}

function selectDayOption(day) {
  saveDayLabelValue(day);
}

function saveDayLabel() {
  const custom = document.getElementById('custom-day-input').value.trim();
  if (custom) {
    saveDayLabelValue(custom);
  } else {
    showToast('Enter a day or pick one above');
  }
}

function saveDayLabelValue(day) {
  const d = state.program.find(d => d.id === editingDayId);
  d.day = day;
  saveState();
  renderHome();
  closeEditDayModal();
  showToast(`Day updated to ${day}`);
}

function closeEditDayModal() {
  document.getElementById('edit-day-modal').classList.remove('open');
  editingDayId = null;
}

</script>

<!-- EDIT DAY MODAL -->
<div class="modal-overlay" id="edit-day-modal">
  <div class="modal">
    <div class="modal-title">RENAME DAY</div>
    <div class="modal-sub">What day will you do this session?</div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:16px;" id="day-options-grid"></div>
    <div style="margin-bottom:12px;">
      <div class="notes-label" style="margin-bottom:6px;">CUSTOM DAY</div>
      <input type="text" id="custom-day-input" class="set-input" placeholder="e.g. Any Day" style="width:100%; text-align:left; padding:10px 14px;"/>
    </div>
    <button class="swap-perm-btn" style="width:100%; padding:14px; font-size:16px; letter-spacing:1px;" onclick="saveDayLabel()">SAVE</button>
    <button class="modal-cancel" onclick="closeEditDayModal()">CANCEL</button>
  </div>
</div>


<!-- INSTALL INSTRUCTIONS MODAL -->
<div id="install-instructions" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:600; align-items:flex-end; justify-content:center;">
  <div style="background:var(--dark2); border:1px solid var(--dark3); border-radius:20px 20px 0 0; padding:28px 24px; width:100%; animation: slideUp 0.3s ease;">
    <div style="font-family:'Bebas Neue',cursive; font-size:24px; letter-spacing:2px; color:var(--cream); margin-bottom:6px;">INSTALL T&S MUSCLE</div>
    <div style="font-size:13px; color:var(--gray); margin-bottom:22px;">Follow these steps to add to your home screen:</div>
    
    <div style="display:flex; gap:14px; align-items:flex-start; margin-bottom:18px;">
      <div style="background:var(--red); color:white; font-family:'Bebas Neue',cursive; font-size:18px; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; flex-shrink:0;">1</div>
      <div style="font-family:'Barlow Condensed',sans-serif; font-size:16px; color:var(--white); line-height:1.4;">Tap the <strong style="color:var(--cream);">three-dot menu ‚ãÆ</strong> in the top right of Chrome</div>
    </div>
    <div style="display:flex; gap:14px; align-items:flex-start; margin-bottom:18px;">
      <div style="background:var(--red); color:white; font-family:'Bebas Neue',cursive; font-size:18px; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; flex-shrink:0;">2</div>
      <div style="font-family:'Barlow Condensed',sans-serif; font-size:16px; color:var(--white); line-height:1.4;">Scroll down and tap <strong style="color:var(--cream);">"Add to Home screen"</strong></div>
    </div>
    <div style="display:flex; gap:14px; align-items:flex-start; margin-bottom:24px;">
      <div style="background:var(--red); color:white; font-family:'Bebas Neue',cursive; font-size:18px; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; flex-shrink:0;">3</div>
      <div style="font-family:'Barlow Condensed',sans-serif; font-size:16px; color:var(--white); line-height:1.4;">Tap <strong style="color:var(--cream);">"Add"</strong> ‚Äî T&S Muscle will appear on your home screen</div>
    </div>

    <div style="background:var(--dark3); border-radius:10px; padding:12px 14px; margin-bottom:20px; font-size:13px; color:var(--gray-light); font-family:'Barlow',sans-serif; line-height:1.5;">
      üí° <strong>Tip:</strong> Make sure you're viewing this in <strong>Chrome</strong> (not Samsung Browser or another browser) for the best experience.
    </div>

    <button onclick="document.getElementById('install-instructions').style.display='none'" style="width:100%; background:var(--red); border:none; color:white; padding:14px; border-radius:12px; font-family:'Bebas Neue',cursive; font-size:18px; letter-spacing:2px; cursor:pointer;">GOT IT</button>
  </div>
</div>

</body>
</html>
